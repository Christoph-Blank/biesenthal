(window.webpackJsonp=window.webpackJsonp||[]).push([[217],{1938:function(e,z,_){"use strict";_.r(z),function(e,i){_.d(z,"getReportMarkerColor",function(){return f}),_.d(z,"getReportMarkerStyle",function(){return p}),_.d(z,"getReportPolygonStyle",function(){return d}),_.d(z,"getReportPolygonEditStyle",function(){return t}),_.d(z,"clusterStyle",function(){return w});var s=_(43),a=_(81),o=_(41),r=_(37),n=_(34),u=_(23),l=_(113),c=_(188),g=_(123),h=_(36);function f(e){switch(e.get("status")){case"ungeprueft":return"#FF8080";case"geprueft":case"uebergeben":case"zurueckgestellt":case"vorbereitet":case"eingearbeitet":return"#FF9955";case"erledigt":return"#8DD35F";case"festgelegt":return"#65A3FF";case"archiviert":return"#CCCCCC";case"abgelehnt":return"#969696";case"geloescht":return"#646464";default:return"white"}}function p(e,t){return new u.c({text:new l.a({text:"",font:"4em Glyphicons Halflings",offsetX:0,offsetY:-20,fill:new r.a({color:f(e)}),scale:t,stroke:new n.a({color:"black",width:2})})})}function d(e){return new u.c({stroke:new n.a({color:f(e),width:2}),fill:new r.a({color:f(e)+"80"})})}function t(e){var t=f(e);return new u.c({stroke:new n.a({color:t,width:4}),fill:new r.a({color:t+"80"})})}function w(e){return[new u.c({text:new l.a({text:"",font:"900 4em 'Font Awesome 5 Free'",offsetX:0,offsetY:-15,fill:new r.a({color:"#FF9955"}),stroke:new n.a({color:"black",width:2})})}),new u.c({text:new l.a({text:e.toString(),offsetX:0,offsetY:-20,font:"'MasterPortalFont', 'Arial Narrow', Arial, sans-serif",fill:new r.a({color:"black"})})})]}var m=e.Model.extend({defaults:{nutzer_fehlermeldung:"",nutzer_name:"",nutzer_email:"",nutzer_institution:"",nutzer_telefon:"",nutzer_url:"",the_geom:"",privacyAgreement:!1,saveFeatureSuccessDescription:"",saveFeatureErrorDescription:"",fetchFeaturesErrorDescription:"",urlEndpoint:"",apiAuthUser:"",apiAuthPassword:"",public:!0,max_mitteilung_length:1e3,max_vertices:100},url:function(){return this.get("public")?this.get("urlEndpoint"):this.get("urlEndpoint")+"private"},postUrl:function(){return this.get("urlEndpoint")},validate:function(){var e=[],t=this.get("the_geom").geometry.coordinates[0][0].length-1,r=this.get("nutzer_fehlermeldung"),n=/^[0-9a-zA-ZäüöÄÜÖß ,.:\-\n\r?]+$/;return r||e.push("description"),this.get("privacyAgreement")||e.push("privacyAgreement"),this.get("nutzer_email")&&!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(this.get("nutzer_email"))&&e.push("nutzer_email"),t>this.get("max_vertices")&&e.push("the_geom"),r&&r.length>this.get("max_mitteilung_length")&&e.push("descriptionlength"),r&&!n.test(r)&&e.push("descriptioninvalid"),this.get("nutzer_name")&&!n.test(this.get("nutzer_name"))&&e.push("nameinvalid"),this.get("nutzer_institution")&&!n.test(this.get("nutzer_institution"))&&e.push("institutioninvalid"),this.get("nutzer_telefon")&&!/^[0-9-./+@ ]+$/.test(this.get("nutzer_telefon"))&&e.push("telefoninvalid"),e},setGeometry:function(e){this.set("geometry",e)},saveData:function(){var e=this.get("the_geom");e.properties={nutzer_fehlermeldung:this.get("nutzer_fehlermeldung"),nutzer_name:this.get("nutzer_name"),nutzer_email:this.get("nutzer_email"),nutzer_institution:this.get("nutzer_institution"),nutzer_telefon:this.get("nutzer_telefon"),nutzer_url:this.get("nutzer_url")};var t=this,r={"Content-Type":"application/json"};return!this.get("public")&&this.get("apiAuthUser")&&this.get("apiAuthPassword")&&(r.Authorization="Basic ".concat(btoa(this.get("apiAuthUser")+":"+this.get("apiAuthPassword")))),fetch(this.postUrl(),{method:"POST",body:JSON.stringify(e),headers:r}).then(function(e){return e.json()}).then(function(e){return i.trigger("Alert","alert",{text:t.get("saveFeatureSuccessDescription"),kategorie:"alert-success"}),window.setTimeout(function(){i.trigger("Alert","alert:remove")},3e3),e}).catch(function(){i.trigger("Alert","alert",{text:t.get("saveFeatureErrorDescription"),kategorie:"alert-danger"}),window.setTimeout(function(){i.trigger("Alert","alert:remove")},3e3)})},fetchReportFeatures:function(){var e={"Content-Type":"application/json"};return!this.get("public")&&this.get("apiAuthUser")&&this.get("apiAuthPassword")&&(e.Authorization="Basic ".concat(btoa(this.get("apiAuthUser")+":"+this.get("apiAuthPassword")))),fetch(this.url(),{method:"GET",headers:e}).then(function(e){return e.json()}).then(function(e){var t,r=new s.a({source:new c.a({distance:50,source:new o.a({features:(new a.a).readFeatures(e)})}),visible:!0,style:function(e){if(e.get("features")){var t=e.get("features").length;return 1===t?p(e.get("features")[0],1):w(t)}return p(e,1)},zIndex:1002});if(!this.get("public")){var n=[];(new a.a).readFeatures(e).forEach(function(e){n.push(new h.a({geometry:new g.a(e.get("the_geom").coordinates),fid:e.get("fid"),status:e.get("status")}))}),t=new s.a({source:new o.a({features:n}),visible:!0,renderMode:"image",maxResolution:i.request("Map","getMap").getView().getResolutionForZoom(4),style:function(e){return d(e)},zIndex:1001})}return{featurePoints:r,featurePolygons:t}}.bind(this)).catch(function(){i.trigger("Alert","alert",{text:this.get("fetchFeaturesErrorDescription"),kategorie:"alert-danger"})}.bind(this))}});z.default=m}.call(this,_(5),_(4))}}]);