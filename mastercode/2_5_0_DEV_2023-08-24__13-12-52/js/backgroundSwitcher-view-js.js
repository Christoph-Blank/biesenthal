(window.webpackJsonp=window.webpackJsonp||[]).push([[162,54],{1897:function(e,a,n){"use strict";n.r(a),function(u,i,t){var e=n(18),p=n(296),v=n(8),r=e.a.extend({defaults:{currentLng:"",id:"backgroundSwitcher",i18nTitle:"",i18nShowSwitcher:"",i18nHideSwitcher:"",backgroundLayers:[],activeLayer:null,open:!1,previews:[],layerSliderPosition:0},type:"tool",name:"Background Switcher",glyphicon:"glyphicon-example",initialize:function(){this.superInitialize();var r=u.request("Parser","getItemsByAttributes",{isBaseLayer:!0})||[],e=u.request("Map","getMap");r=r.filter(function(e){return!0!==e.isNeverVisibleInTree}),u.request("Parser","getItemsByAttributes",{type:"folder"}).filter(function(e){return e.layerSliderConfig}).forEach(function(t){t.layerSliderConfig.layers.forEach(function(e){var i=u.request("Parser","getItemByAttributes",{id:e.layerId});i&&(i.isSliderLayer=!0,i.sliderParent=t,r.push(i))})}),this.set("backgroundLayers",r),this.set("activeLayer",r.find(function(e){return e.isVisibleInMap})),e.on("moveend",i.debounce(this.updatePreviews.bind(this),200)),e.getLayerGroup().on("change",this.updatePreviews.bind(this)),this.listenTo(u.channel("ModelList"),{updatedSelectedLayerList:this.updateActiveLayer}),this.updatePreviews(),this.listenTo(u.channel("i18next"),{languageChanged:this.changeLang}),this.changeLang(t.language)},updateActiveLayer:function(e){var i=e[0],t=this.get("activeLayer");i&&i.get("isBaseLayer")&&i.get("isSelected")&&i.get("id")!==t.id&&1!=t.isSliderLayer&&this.setActiveLayerById(i.get("id"))},showLayerInformation:function(s){this.get("backgroundLayers").forEach(function(e){var i=u.request("ModelList","getModelsByAttributes",{id:e.id});if(i&&(i=i[0]).id===s){var t,r=[],a=i.get("name"),n=i.get("datasets")&&i.get("datasets")[0]?i.get("datasets")[0].md_id:null;""===i.get("legendURL")&&i.createLegendURL(),t=u.request("Legend","getLegend",i),r.push(n),u.trigger("LayerInformation","add",{id:i.get("id"),legend:t,metaID:r,layername:a,url:i.get("url"),typ:i.get("typ"),urlIsVisible:i.get("urlIsVisible"),externalInfo:i.get("externalInfo"),capabilitiesUrl:i.get("capabilitiesUrl")})}})},setActiveLayerById:function(t){var e=this.get("backgroundLayers").find(function(e){return e.id===t});this.set("activeLayer",e),e.isSliderLayer&&0!==this.get("layerSliderPosition")||(this.get("backgroundLayers").forEach(function(e){var i=u.request("ModelList","getModelsByAttributes",{id:e.id});i&&((i=i[0]).id===t?(i.setIsVisibleInMap(!0),i.setIsSelected(!0)):(i.setIsVisibleInMap(!1),i.setIsSelected(!1)))}),u.trigger("Util","refreshTree"))},updatePreviews:function(){var t=this.calculateExtent(u.request("MapView","getCurrentExtent")),r=u.request("MapView","getProjection").getCode(),e=this.get("backgroundLayers").map(function(e){var i=new URL(e.url);return i.searchParams.append("REQUEST","GetMap"),i.searchParams.append("SERVICE","WMS"),i.searchParams.append("VERSION",e.version),"1.3.0"===e.version?i.searchParams.append("CRS",r):i.searchParams.append("SRS",r),i.searchParams.append("LAYERS",e.layers),i.searchParams.append("FORMAT",e.format),i.searchParams.append("WIDTH","256"),i.searchParams.append("HEIGHT","256"),i.searchParams.append("STYLES",""),i.searchParams.append("BBOX",t),{layer:e,img:i.href}});this.set("previews",e)},calculateExtent:function(e){var i,t,r=u.request("MapView","getProjection").getCode(),a=u.request("Map","getMap").getView().getCenter();t="EPSG:4326"!==r?(i=Object(v.o)(e,r,"EPSG:4326"),Object(v.n)(a,r,"EPSG:4326")):(i=e,a);var n={units:"degrees"},s=Object(p.distance)(t,[i[2],t[1]],n),c=Object(p.distance)(t,[t[0],i[3]],n);if(c<s){var d=Object(p.destination)(t,s,180,n),l=Object(p.destination)(t,s,0,n);i[1]=d.geometry.coordinates[1],i[3]=l.geometry.coordinates[1]}else if(s<c){var o=Object(p.destination)(t,c,270,n),h=Object(p.destination)(t,c,90,n);i[0]=o.geometry.coordinates[0],i[2]=h.geometry.coordinates[0]}if("EPSG:4326"!==r)return Object(v.o)(i,"EPSG:4326",r);var g=[];return g.push(i[1]),g.push(i[0]),g.push(i[3]),g.push(i[2]),g},changeLang:function(e){this.set({currentLng:e,i18nTitle:t.t("additional:backgroundSwitcher.i18nTitle"),i18nShowSwitcher:t.t("additional:backgroundSwitcher.i18nShowSwitcher"),i18nHideSwitcher:t.t("additional:backgroundSwitcher.i18nHideSwitcher")})}});a.default=r}.call(this,n(4),n(3),n(24))},2027:function(e,l,o){"use strict";o.r(l),function(e,i,n){var t=o(2112),r=o.n(t),a=o(1897),s=(o(1974),o(2113),o(2114),o(452)),c=o(449),d=e.View.extend({events:{"click .info-btn":"showLayerInformations","click .expanded .backgroundswitcher-preview > img":"setBackgroundLayer","click .titlebar, .collapsed img, .collapsed .backgroundswitcher-label":"toggle","touchstart .titlebar":"toggle"},initialize:function(){this.model=new a.default,this.listenTo(this.model,{"change:activeLayer":this.renderActiveLayer,"change:open":this.render,"change:previews":this.renderPreviews,"change:currentLng":this.render}),this.model.get("backgroundLayers").length<2?console.warn("You need to have at least 2 background layers to use the backgroundswitcher."):this.render(this.model,!0)},template:i.template(r.a),render:function(){var e=this.model.toJSON(),i=this.model.get("backgroundLayers").length,t=n(".background-switcher")[0];if(!t){var r=n("#map");0<r.length?r.append("<div class='background-switcher'></div>"):n("body").append("<div class='background-switcher'></div>"),t=n(".background-switcher")[0]}return this.setElement(t),this.$el.html(this.template(e)),n(".background-switcher .expanded").slick({dots:!1,arrows:!0,prevArrow:'<div class="glyphicon-arrow-left fas fa-angle-left" style="bottom: 40%; right: 100%" aria-label="Previous"></div>',nextArrow:'<div class="glyphicon-arrow-right fas fa-angle-right" style="bottom: 40%; left: 100%" aria-label="Next"></div>',infinite:!0,slidesToShow:4<i?4:i,slidesToScroll:1,speed:300,responsive:[{breakpoint:1024,settings:{slidesToShow:3<i?3:i,slidesToScroll:3<i?3:i}},{breakpoint:480,settings:{slidesToShow:2,slidesToScroll:2}}]}),this.renderOpacitySlider(),this},renderPreviews:function(e,i){i.forEach(function(i){var t=n("<img src='"+i.img+"' class='"+i.layer.id+"' style='opacity:0'></img>");t[0].onload=function(){var e=n(".background-switcher img."+i.layer.id);e&&e.length&&n(e[0]).fadeOut(100,function(){e[0].replaceWith(t[0]),n(t[0]).fadeTo(100,1)})}})},renderActiveLayer:function(){var e=this.model.toJSON(),i=n(".backgroundswitcher-preview > img[id='"+e.activeLayer.id+"']"),t=n(".backgroundswitcher-preview.active");t&&t.each(function(e,i){i.className="backgroundswitcher-preview"}),i&&i.each(function(e,i){i.parentNode.className="backgroundswitcher-preview active"}),this.renderOpacitySlider(),this.close(),this.render()},renderOpacitySlider:function(){var e=this.model.get("activeLayer"),i=n("#map .opacity-slider")[0];if(i&&i.parentNode.removeChild(i),e&&e.isSliderLayer){var t=new c.a({renderToWindow:!1,sliderType:"handle",isActive:!0,title:e.sliderParent.layerSliderConfig.title,layerIds:e.sliderParent.layerSliderConfig.layers}),r=n("<div class='opacity-slider'></div>"),a=document.getElementsByClassName;n("#map")[0].append(r[0]),document.getElementsByClassName=function(){return[n("#map .opacity-slider")[0]]},new s.a({model:t,callback:this.saveSliderPosition.bind(this),initSliderPosition:this.model.get("layerSliderPosition")}),document.getElementsByClassName=a}},saveSliderPosition:function(e){this.model.set("layerSliderPosition",e)},showLayerInformations:function(e){e.target.classList.length&&this.model.showLayerInformation(e.target.classList[0])},setBackgroundLayer:function(e){e.target.classList.length&&this.model.setActiveLayerById(e.target.classList[0])},toggle:function(){this.model.set("open",!this.model.get("open")),this.model.updatePreviews()},close:function(){this.model.set("open",!1),this.model.updatePreviews()}});l.default=d}.call(this,o(5),o(3),o(1771))},2112:function(e,i){e.exports='<!DOCTYPE html>\r\n<% if (open) { %>\r\n    <div class="titlebar">\r\n        <span class="glyphicon fas fa-caret-right" title="<%= i18nHideSwitcher %>"></span>\r\n    </div>\r\n    <div class="expanded">\r\n        <% var sliderParent; %>\r\n            <% _.each(previews, function (preview) { %>\r\n                <% if (preview.layer.sliderParent) { %>\r\n                    <% if (!sliderParent) { %>\r\n                        <div class="backgroundswitcher-preview slider">\r\n                            <% sliderParent = preview.layer.sliderParent; %>\r\n                                <% } else { %>\r\n                                    <% return; %>\r\n                                        <% } %>\r\n                                            <% } else if (preview.layer === activeLayer) { %>\r\n                                                <div class="backgroundswitcher-preview active">\r\n                                                    <% } else { %>\r\n                                                        <div class="backgroundswitcher-preview">\r\n                                                            <% } %>\r\n                                                                <div class="backgroundswitcher-label">\r\n                                                                    <% if (sliderParent) { %>\r\n                                                                        <%= sliderParent.name %>\r\n                                                                            <% } else { %>\r\n                                                                                <%= preview.layer.name %>\r\n                                                                                    <% } %>\r\n                                                                </div>\r\n                                                                <span class="<%= preview.layer.id %> fas fa-info-circle info-btn"></span>\r\n                                                                <img src=" <%= preview.img %> " class="<%= preview.layer.id %>"/>\r\n                                                        </div>\r\n                                                        <% }); %>\r\n                                                </div>\r\n                                                <% } else { %>\r\n                                                    <div class="titlebar">\r\n                                                        <span class="glyphicon fas fa-caret-left" title="<%= i18nShowSwitcher %>"></span>\r\n                                                    </div>\r\n                                                    <div class="collapsed">\r\n                                                        <% _.each(previews, function (preview) { %>\r\n                                                            <% if (preview.layer === activeLayer) { %>\r\n                                                                <div class="backgroundswitcher-preview active">\r\n                                                                    <div class="backgroundswitcher-label">\r\n                                                                        <% if (activeLayer.sliderParent) { %>\r\n                                                                            <%= activeLayer.sliderParent.name %>\r\n                                                                                <% } else { %>\r\n                                                                                    <%= activeLayer.name %>\r\n                                                                                        <% } %>\r\n                                                                    </div>\r\n                                                                    <span class="<%= preview.layer.id %> fas fa-info-circle info-btn"></span>\r\n                                                                    <img src=" <%= preview.img %> " class="<%= preview.layer.id %>" />\r\n                                                                </div>\r\n                                                                <% } %>\r\n                                                                    <% }); %>\r\n                                                    </div>\r\n                                                    <% } %>\r\n'},2113:function(e,i,t){},2114:function(e,i,t){}}]);