(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{2196:function(e,t,r){"use strict";var u=r(80),c=r(24),o=r(112),a=r(302),s=r(99),f=r(59),i=r(72);function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function h(e,t){return(h=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(i){var u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,n=p(i);if(u){var o=p(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==l(r)&&"function"!=typeof r?function(e){if(void 0!==e)return e;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):r}}function p(e){return(p=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var v="snap",g=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&h(e,t)}(o,i["a"]);var n=y(o);function o(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),(r=n.call(this,e)).vertex=t.vertex,r.vertexPixel=t.vertexPixel,r.feature=t.feature,r}return o}(),S=r(1),P=r(51),b=r(45),F=r(6),d=r(10),_=r(22);function m(e){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],n=!0,o=!1,i=void 0;try{for(var u,a=e[Symbol.iterator]();!(n=(u=a.next()).done)&&(r.push(u.value),!t||r.length!==t);n=!0);}catch(e){o=!0,i=e}finally{try{n||null==a.return||a.return()}finally{if(o)throw i}}return r}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return n(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function O(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function j(e,t,r){return(j="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=R(e)););return e}(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function E(e,t){return(E=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(i){var u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t,r,n=R(i);if(u){var o=R(this).constructor;e=Reflect.construct(n,arguments,o)}else e=n.apply(this,arguments);return t=this,!(r=e)||"object"!==m(r)&&"function"!=typeof r?w(t):r}}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e){return e.feature?e.feature:e.element?e.element:null}var T=[],M=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&E(e,t)}(i,o["b"]);var e,t,r,n=x(i);function i(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var r=e=e||{};return r.handleDownEvent||(r.handleDownEvent=f.b),r.stopDown||(r.stopDown=f.a),(t=n.call(this,r)).on,t.once,t.un,t.source_=e.source?e.source:null,t.vertex_=void 0===e.vertex||e.vertex,t.edge_=void 0===e.edge||e.edge,t.features_=e.features?e.features:null,t.featuresListenerKeys_=[],t.featureChangeListenerKeys_={},t.indexedFeaturesExtents_={},t.pendingFeatures_={},t.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10,t.rBush_=new a.a,t.GEOMETRY_SEGMENTERS_={Point:t.segmentPointGeometry_.bind(w(t)),LineString:t.segmentLineStringGeometry_.bind(w(t)),LinearRing:t.segmentLineStringGeometry_.bind(w(t)),Polygon:t.segmentPolygonGeometry_.bind(w(t)),MultiPoint:t.segmentMultiPointGeometry_.bind(w(t)),MultiLineString:t.segmentMultiLineStringGeometry_.bind(w(t)),MultiPolygon:t.segmentMultiPolygonGeometry_.bind(w(t)),GeometryCollection:t.segmentGeometryCollectionGeometry_.bind(w(t)),Circle:t.segmentCircleGeometry_.bind(w(t))},t}return e=i,(t=[{key:"addFeature",value:function(t,e){e=void 0===e||e;var r=Object(d.b)(t),n=t.getGeometry();if(n){var o=this.GEOMETRY_SEGMENTERS_[n.getType()];if(o){this.indexedFeaturesExtents_[r]=n.getExtent(Object(S.j)());var i=[];if(o(i,n),1===i.length)this.rBush_.insert(Object(S.b)(i[0]),{feature:t,segment:i[0]});else if(1<i.length){var u=i.map(function(e){return Object(S.b)(e)}),a=i.map(function(e){return{feature:t,segment:e}});this.rBush_.load(u,a)}}}e&&(this.featureChangeListenerKeys_[r]=Object(_.a)(t,c.a.CHANGE,this.handleFeatureChange_,this))}},{key:"getFeatures_",value:function(){var e;return this.features_?e=this.features_:this.source_&&(e=this.source_.getFeatures()),e}},{key:"handleEvent",value:function(e){var t=this.snapTo(e.pixel,e.coordinate,e.map);return t&&(e.coordinate=t.vertex.slice(0,2),e.pixel=t.vertexPixel,this.dispatchEvent(new g(v,{vertex:e.coordinate,vertexPixel:e.pixel,feature:t.feature}))),j(R(i.prototype),"handleEvent",this).call(this,e)}},{key:"handleFeatureAdd_",value:function(e){var t=C(e);t&&this.addFeature(t)}},{key:"handleFeatureRemove_",value:function(e){var t=C(e);t&&this.removeFeature(t)}},{key:"handleFeatureChange_",value:function(e){var t=e.target;if(this.handlingDownUpSequence){var r=Object(d.b)(t);r in this.pendingFeatures_||(this.pendingFeatures_[r]=t)}else this.updateFeature_(t)}},{key:"handleUpEvent",value:function(){var e=Object.values(this.pendingFeatures_);return e.length&&(e.forEach(this.updateFeature_.bind(this)),this.pendingFeatures_={}),!1}},{key:"removeFeature",value:function(t,e){var r=void 0===e||e,n=Object(d.b)(t),o=this.indexedFeaturesExtents_[n];if(o){var i=this.rBush_,u=[];i.forEachInExtent(o,function(e){t===e.feature&&u.push(e)});for(var a=u.length-1;0<=a;--a)i.remove(u[a])}r&&(Object(_.c)(this.featureChangeListenerKeys_[n]),delete this.featureChangeListenerKeys_[n])}},{key:"setMap",value:function(e){var t=this,r=this.getMap(),n=this.featuresListenerKeys_,o=this.getFeatures_();r&&(n.forEach(_.c),n.length=0,this.rBush_.clear(),Object.values(this.featureChangeListenerKeys_).forEach(_.c),this.featureChangeListenerKeys_={}),j(R(i.prototype),"setMap",this).call(this,e),e&&(this.features_?n.push(Object(_.a)(this.features_,u.a.ADD,this.handleFeatureAdd_,this),Object(_.a)(this.features_,u.a.REMOVE,this.handleFeatureRemove_,this)):this.source_&&n.push(Object(_.a)(this.source_,s.a.ADDFEATURE,this.handleFeatureAdd_,this),Object(_.a)(this.source_,s.a.REMOVEFEATURE,this.handleFeatureRemove_,this)),o.forEach(function(e){return t.addFeature(e)}))}},{key:"snapTo",value:function(t,e,r){var o,i=r.getView().getProjection(),u=Object(F.j)(e,i),n=Object(F.u)(Object(S.c)(Object(S.b)([u]),r.getView().getResolution()*this.pixelTolerance_),i),a=this.rBush_.getInExtent(n),c=a.length;if(0===c)return null;function s(){if(o){var e=r.getPixelFromCoordinate(o);if(Object(P.i)(t,e)<=h)return{vertex:o,vertexPixel:[Math.round(e[0]),Math.round(e[1])],feature:f}}return null}var f,l=1/0,h=this.pixelTolerance_*this.pixelTolerance_;if(this.vertex_){for(var y=function(e){var n=a[e];"Circle"!==n.feature.getGeometry().getType()&&n.segment.forEach(function(e){var t=Object(F.j)(e,i),r=Object(P.i)(u,t);r<l&&(o=e,l=r,f=n.feature)})},p=0;p<c;++p)y(p);var v=s();if(v)return v}if(this.edge_){for(var g=0;g<c;++g){var b=null,d=a[g];if("Circle"===d.feature.getGeometry().getType()){var _=d.feature.getGeometry(),m=Object(F.q)();m&&(_=_.clone().transform(m,i)),b=Object(P.b)(u,_)}else{var O=G(d.segment,2),j=O[0],E=O[1];E&&(T[0]=Object(F.j)(j,i),T[1]=Object(F.j)(E,i),b=Object(P.c)(u,T))}if(b){var x=Object(P.i)(u,b);x<l&&(o=Object(F.t)(b,i),l=x)}}var w=s();if(w)return w}return null}},{key:"updateFeature_",value:function(e){this.removeFeature(e,!1),this.addFeature(e,!1)}},{key:"segmentCircleGeometry_",value:function(e,t){var r=this.getMap().getView().getProjection(),n=t,o=Object(F.q)();o&&(n=n.clone().transform(o,r));var i=Object(b.c)(n);o&&i.transform(r,o);for(var u=i.getCoordinates()[0],a=0,c=u.length-1;a<c;++a)e.push(u.slice(a,a+2))}},{key:"segmentGeometryCollectionGeometry_",value:function(e,t){for(var r=t.getGeometriesArray(),n=0;n<r.length;++n){var o=this.GEOMETRY_SEGMENTERS_[r[n].getType()];o&&o(e,r[n])}}},{key:"segmentLineStringGeometry_",value:function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length-1;n<o;++n)e.push(r.slice(n,n+2))}},{key:"segmentMultiLineStringGeometry_",value:function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],u=0,a=i.length-1;u<a;++u)e.push(i.slice(u,u+2))}},{key:"segmentMultiPointGeometry_",value:function(t,e){e.getCoordinates().forEach(function(e){t.push([e])})}},{key:"segmentMultiPolygonGeometry_",value:function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],u=0,a=i.length;u<a;++u)for(var c=i[u],s=0,f=c.length-1;s<f;++s)e.push(c.slice(s,s+2))}},{key:"segmentPointGeometry_",value:function(e,t){e.push([t.getCoordinates()])}},{key:"segmentPolygonGeometry_",value:function(e,t){for(var r=t.getCoordinates(),n=0,o=r.length;n<o;++n)for(var i=r[n],u=0,a=i.length-1;u<a;++u)e.push(i.slice(u,u+2))}}])&&O(e.prototype,t),r&&O(e,r),i}();t.a=M}}]);