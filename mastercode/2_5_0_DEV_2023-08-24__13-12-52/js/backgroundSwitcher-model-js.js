(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{1897:function(e,r,n){"use strict";n.r(r),function(h,t,i){var e=n(18),p=n(296),y=n(8),a=e.a.extend({defaults:{currentLng:"",id:"backgroundSwitcher",i18nTitle:"",i18nShowSwitcher:"",i18nHideSwitcher:"",backgroundLayers:[],activeLayer:null,open:!1,previews:[],layerSliderPosition:0},type:"tool",name:"Background Switcher",glyphicon:"glyphicon-example",initialize:function(){this.superInitialize();var a=h.request("Parser","getItemsByAttributes",{isBaseLayer:!0})||[],e=h.request("Map","getMap");a=a.filter(function(e){return!0!==e.isNeverVisibleInTree}),h.request("Parser","getItemsByAttributes",{type:"folder"}).filter(function(e){return e.layerSliderConfig}).forEach(function(i){i.layerSliderConfig.layers.forEach(function(e){var t=h.request("Parser","getItemByAttributes",{id:e.layerId});t&&(t.isSliderLayer=!0,t.sliderParent=i,a.push(t))})}),this.set("backgroundLayers",a),this.set("activeLayer",a.find(function(e){return e.isVisibleInMap})),e.on("moveend",t.debounce(this.updatePreviews.bind(this),200)),e.getLayerGroup().on("change",this.updatePreviews.bind(this)),this.listenTo(h.channel("ModelList"),{updatedSelectedLayerList:this.updateActiveLayer}),this.updatePreviews(),this.listenTo(h.channel("i18next"),{languageChanged:this.changeLang}),this.changeLang(i.language)},updateActiveLayer:function(e){var t=e[0],i=this.get("activeLayer");t&&t.get("isBaseLayer")&&t.get("isSelected")&&t.get("id")!==i.id&&1!=i.isSliderLayer&&this.setActiveLayerById(t.get("id"))},showLayerInformation:function(s){this.get("backgroundLayers").forEach(function(e){var t=h.request("ModelList","getModelsByAttributes",{id:e.id});if(t&&(t=t[0]).id===s){var i,a=[],r=t.get("name"),n=t.get("datasets")&&t.get("datasets")[0]?t.get("datasets")[0].md_id:null;""===t.get("legendURL")&&t.createLegendURL(),i=h.request("Legend","getLegend",t),a.push(n),h.trigger("LayerInformation","add",{id:t.get("id"),legend:i,metaID:a,layername:r,url:t.get("url"),typ:t.get("typ"),urlIsVisible:t.get("urlIsVisible"),externalInfo:t.get("externalInfo"),capabilitiesUrl:t.get("capabilitiesUrl")})}})},setActiveLayerById:function(i){var e=this.get("backgroundLayers").find(function(e){return e.id===i});this.set("activeLayer",e),e.isSliderLayer&&0!==this.get("layerSliderPosition")||(this.get("backgroundLayers").forEach(function(e){var t=h.request("ModelList","getModelsByAttributes",{id:e.id});t&&((t=t[0]).id===i?(t.setIsVisibleInMap(!0),t.setIsSelected(!0)):(t.setIsVisibleInMap(!1),t.setIsSelected(!1)))}),h.trigger("Util","refreshTree"))},updatePreviews:function(){var i=this.calculateExtent(h.request("MapView","getCurrentExtent")),a=h.request("MapView","getProjection").getCode(),e=this.get("backgroundLayers").map(function(e){var t=new URL(e.url);return t.searchParams.append("REQUEST","GetMap"),t.searchParams.append("SERVICE","WMS"),t.searchParams.append("VERSION",e.version),"1.3.0"===e.version?t.searchParams.append("CRS",a):t.searchParams.append("SRS",a),t.searchParams.append("LAYERS",e.layers),t.searchParams.append("FORMAT",e.format),t.searchParams.append("WIDTH","256"),t.searchParams.append("HEIGHT","256"),t.searchParams.append("STYLES",""),t.searchParams.append("BBOX",i),{layer:e,img:t.href}});this.set("previews",e)},calculateExtent:function(e){var t,i,a=h.request("MapView","getProjection").getCode(),r=h.request("Map","getMap").getView().getCenter();i="EPSG:4326"!==a?(t=Object(y.o)(e,a,"EPSG:4326"),Object(y.n)(r,a,"EPSG:4326")):(t=e,r);var n={units:"degrees"},s=Object(p.distance)(i,[t[2],i[1]],n),d=Object(p.distance)(i,[i[0],t[3]],n);if(d<s){var c=Object(p.destination)(i,s,180,n),o=Object(p.destination)(i,s,0,n);t[1]=c.geometry.coordinates[1],t[3]=o.geometry.coordinates[1]}else if(s<d){var u=Object(p.destination)(i,d,270,n),g=Object(p.destination)(i,d,90,n);t[0]=u.geometry.coordinates[0],t[2]=g.geometry.coordinates[0]}if("EPSG:4326"!==a)return Object(y.o)(t,"EPSG:4326",a);var l=[];return l.push(t[1]),l.push(t[0]),l.push(t[3]),l.push(t[2]),l},changeLang:function(e){this.set({currentLng:e,i18nTitle:i.t("additional:backgroundSwitcher.i18nTitle"),i18nShowSwitcher:i.t("additional:backgroundSwitcher.i18nShowSwitcher"),i18nHideSwitcher:i.t("additional:backgroundSwitcher.i18nHideSwitcher")})}});r.default=a}.call(this,n(4),n(3),n(24))}}]);