(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1861:function(e,f,p){"use strict";p.r(f),function(e,l,t,a){var r=p(78),i=p(94),n=p(50),o=p(42),s=p(36),g=p(81),u=p(126),d=p(146),c=p(189),y=p(43);var h=e.Model.extend({defaults:{uniqueIdList:[],currentLng:"",mapProjectionNotSupportedForLayer:"Die aktuelle Kartenprojektion wird für diesen Layer nicht unterstützt"},initialize:function(){this.listenTo(l.channel("CswParser"),{fetchedMetaData:this.fetchedMetaData,languageChanged:this.changeLang}),this.changeLang(t.language)},fetchedMetaData:function(e){this.isOwnMetaRequest(this.get("uniqueIdList"),e.uniqueId)&&(this.removeUniqueIdFromList(this.get("uniqueIdList"),e.uniqueId),this.updateMetaData(e.layerName,e.parsedData))},isOwnMetaRequest:function(e,t){return Array.isArray(e)&&-1!==e.indexOf(t)},removeUniqueIdFromList:function(e,t){this.setUniqueIdList(a.without(e,t))},updateMetaData:function(e,t){var r=this.get("attributes").hasOwnProperty("legend")&&this.get("attributes").legend.hasOwnProperty("layers")?this.get("attributes").legend.layers:void 0,i=a.findWhere(r,{layerName:e});void 0!==i&&(i.metaDate=t.hasOwnProperty("date")?t.date:"n.N.",i.metaOwner=t.hasOwnProperty("orgaOwner")?t.orgaOwner:"n.N.",i.metaAddress=t.hasOwnProperty("address")?this.parseAddressToString(t.address):"n.N.",i.metaEmail=t.hasOwnProperty("email")?t.email:"n.N.",i.metaTel=t.hasOwnProperty("tel")?t.tel:"n.N.",i.metaUrl=t.hasOwnProperty("url")?t.url:"n.N.")},parseAddressToString:function(e){var t=void 0===e?void 0:e.street,r=void 0===e?void 0:e.housenr,i=void 0===e?void 0:e.postalCode,n=void 0===e?void 0:e.city,a="";return a+=void 0===t?"":t,a+=""===a?"":" ",a+=void 0===r?"":r,a+=""===a?"":a+"\n ",a+=void 0===i?"":i,a+=""===a?"":" ",a+=void 0===n?"":n,a+=""===a?"n.N.":""},buildLayers:function(e){var r=[],t=this.get("attributes"),i=l.request("MapView","getOptions").resolution;e.forEach(function(e){var t=[];e instanceof u.a?e.getLayers().getArray().forEach(function(e){t.push(this.buildLayerType(e,i))},this):t.push(this.buildLayerType(e,i)),t.forEach(function(e){void 0!==e&&r.push(e)})},this),t.map.layers=r.reverse()},getDrawLayerInfo:function(e,t){var r=e.getSource().getFeaturesInExtent(t),i=a.sortBy(r,function(e){return e.getStyle().getZIndex()});if(0<i.length)return this.buildVector(e,i)},buildLayerType:function(e,t){var r,i=l.request("MapView","getCurrentExtent"),n=e.get("minResolution"),a=e.get("maxResolution"),o=[];return this.isInScaleRange(n,a,t)&&(e instanceof d.a?r=this.buildImageWms(e):e instanceof c.a&&"WMS"===e.get("typ")?r=this.buildTileWms(e):e instanceof c.a&&"WMTS"===e.get("typ")?r=this.buildTileWmts(e):"import_draw_layer"===e.get("name")?r=this.getDrawLayerInfo(e,i):e instanceof y.a&&0<(o=e.getSource().getFeaturesInExtent(i)).length&&(r=this.buildVector(e,o))),r},isInScaleRange:function(e,t,r){var i=!1;return e<=r&&r<=t&&(i=!0),i},buildTileWms:function(e){var t=e.getSource(),r={baseURL:t.getUrls()[0],opacity:e.getOpacity(),type:"WMS",layers:t.getParams().LAYERS.split(","),styles:t.getParams().STYLES?t.getParams().STYLES.split(","):void 0,imageFormat:t.getParams().FORMAT,customParams:{TRANSPARENT:t.getParams().TRANSPARENT}};return t.getParams().hasOwnProperty("SLD_BODY")&&void 0!==t.getParams().SLD_BODY&&(r.customParams.SLD_BODY=t.getParams().SLD_BODY,r.styles=["style"]),r},buildTileWmts:function(e){var t=e.getSource(),r=l.request("Map","getMap").getView().getProjection(),i=t.getTileGridForProjection(r);if(i.getMatrixIds){var n=i.getResolutions().map(function(e){return e/28e-5});return{baseURL:this.cleanupUrl(t.getUrls()[0]),customParams:void 0,dimensionParams:void 0,dimensions:t.getDimensions(),failOnError:!0,opacity:e.getOpacity(),type:"wmts",layer:t.getLayer(),mergeableParams:void 0,name:e.get("name"),style:"_empty"!==t.getStyle()?t.getStyle():void 0,imageFormat:t.getFormat(),version:t.getVersion()||"1.0.0",requestEncoding:t.getRequestEncoding(),rasterStyle:"",matrixSet:t.getMatrixSet(),matrices:i.getMatrixIds().map(function(e,t){return{identifier:e,matrixSize:[Math.pow(2,t),Math.pow(2,t)],scaleDenominator:n[t],tileSize:[i.getTileSize(t),i.getTileSize(t)],topLeftCorner:i.getOrigin(t)}})}}l.trigger("Alert","alert",{text:this.get("mapProjectionNotSupportedForLayer")+": "+e.get("name"),kategorie:"alert-warning"})},cleanupUrl:function(e){return e?e.replace("Style","style"):""},buildImageWms:function(e){var t=e.getSource();return{baseURL:t.getUrl(),opacity:e.getOpacity(),type:"WMS",layers:t.getParams().LAYERS.split(","),styles:t.getParams().STYLES?t.getParams().STYLES.split(","):void 0,imageFormat:t.getParams().FORMAT,customParams:{TRANSPARENT:t.getParams().TRANSPARENT}}},buildVector:function(e,t){var r=[];return{type:"geojson",style:this.buildStyle(e,t,r),geojson:r}},buildStyle:function(g,e,u){var d={version:"2"},t=!(!Config.hasOwnProperty("useVectorStyleBeta")||!Config.useVectorStyleBeta)&&Config.useVectorStyleBeta;return e.forEach(function(r){var i,n,a,o,s,e=this.getFeatureStyle(r,g),l=this.getStyleAttribute(g,r,t);e.forEach(function(e,t){if(null!==e){if((i=r.clone()).set(l,i.get(l)+"_"+String(t)),o=r.getGeometry().getType(),null!=(s=e.getGeometryFunction())&&(i.setGeometry(s(i)),o=s(i).getType()),this.addFeatureToGeoJsonList(i,u),n=this.getStylingRule(g,i,l),d.hasOwnProperty(n))return;a={symbolizers:[]},"Point"===o||"MultiPoint"===o?a.symbolizers.push(this.buildPointStyle(e,g)):"Polygon"===o||"MultiPolygon"===o||"Circle"===o?a.symbolizers.push(this.buildPolygonStyle(e,g)):"LineString"!==o&&"MultiLineString"!==o||a.symbolizers.push(this.buildLineStringStyle(e,g)),null!==e.getText()&&void 0!==e.getText()&&a.symbolizers.push(this.buildTextStyle(e.getText())),d[n]=a}},this)},this),d},buildPointStyle:function(e,t){return e.getImage()instanceof r.a?this.buildPointStyleCircle(e.getImage()):e.getImage()instanceof i.a?this.buildPointStyleIcon(e.getImage(),t):this.buildTextStyle(e.getText())},buildPointStyleCircle:function(e){var t=e.getFill(),r=e.getStroke(),i={type:"point",pointRadius:e.getRadius()};return null!==t&&(this.buildFillStyle(t,i),this.buildStrokeStyle(t,i)),null!==r&&this.buildStrokeStyle(r,i),i},buildPointStyleIcon:function(e,t){return{type:"point",graphicWidth:e.getSize()[0]*e.getScale(),graphicHeight:e.getSize()[1]*e.getScale(),externalGraphic:this.buildGraphicPath()+this.getImageName(e.getSrc()),graphicOpacity:t.getOpacity()}},buildGraphicPath:function(){var e="https://test.geoportal-hamburg.de/lgv-config/img",t=window.location.origin;return-1===t.indexOf("localhost")&&(e=t+"/lgv-config/img"),e},buildTextStyle:function(e){return{type:"text",label:void 0!==e.getText()?e.getText():"",fontColor:this.rgbArrayToHex(e.getFill().getColor()),labelOutlineColor:null!==e.getStroke()?this.rgbArrayToHex(e.getStroke().getColor()):void 0,labelXOffset:-e.getOffsetX(),labelYOffset:-e.getOffsetY(),fontSize:e.getFont().split(" ")[0],fontFamily:e.getFont().split(" ")[1],labelAlign:this.getLabelAlign(e)}},getLabelAlign:function(e){var t=e.getTextAlign();return"left"===t?"lb":"right"===t?"rb":"cb"},buildPolygonStyle:function(e,t){var r=e.getFill(),i=e.getStroke(),n={type:"polygon",fillOpacity:t.getOpacity(),strokeOpacity:t.getOpacity()};return this.buildFillStyle(r,n),null!==i&&this.buildStrokeStyle(i,n),n},buildLineStringStyle:function(e,t){var r=e.getStroke(),i={type:"line",strokeOpacity:t.getOpacity()};return this.buildStrokeStyle(r,i),i},buildFillStyle:function(e,t){var r=e.getColor();return"string"==typeof r&&(r=this.colorStringToRgbArray(r)),t.fillColor=this.rgbArrayToHex(r),t.fillOpacity=r[3],t},colorStringToRgbArray:function(e){var t,r=e;return r.match(/^(rgb)/)&&(t=this.rgbStringToRgbArray(r)),t},rgbStringToRgbArray:function(e){var t=e.indexOf("(")+1,r=e.indexOf(")")-t,i=e.substr(t,r).split(","),n=[];return i.forEach(function(e){e.trim(),n.push(parseFloat(e))}),n},buildStrokeStyle:function(e,t){var r=e.getColor();return t.strokeColor=this.rgbArrayToHex(r),Array.isArray(r)&&void 0!==r[3]&&(t.strokeOpacity=r[3]),"function"==typeof e.getWidth&&void 0!==e.getWidth()&&(t.strokeWidth=e.getWidth()),t},getImageName:function(e){var t=e.lastIndexOf("/");return-1!==e.indexOf("/")?e.substr(t):"/"+e},addFeatureToGeoJsonList:function(e,t){var r;void 0!==e.get("features")?e.get("features").forEach(function(e){(r=this.convertFeatureToGeoJson(e))&&t.push(r)},this):(r=this.convertFeatureToGeoJson(e))&&t.push(r)},convertFeatureToGeoJson:function(e){var t,r=new g.a;return"Circle"===e.getGeometry().getType()&&e.setGeometry(Object(o.c)(e.getGeometry())),t=r.writeFeatureObject(e),0===e.getGeometry().getCoordinates().length&&(t=void 0),t},getFeatureStyle:function(e,t){var r;return r=void 0!==e.getStyleFunction()?e.getStyleFunction().call(e):t.getStyleFunction().call(t,e),Array.isArray(r)?r:[r]},getStylingRule:function(e,t,r){var i,n,a,o=l.request("ModelList","getModelByAttributes",{id:e.get("id")}),s=t.get("styleId")?"styleId":r;return""===s?"*":void 0!==t.get("features")?"["+s+"='"+t.get("features")[0].get(s)+"']":void 0!==o&&void 0!==l.request("StyleList","returnModelById",o.get("styleId"))&&void 0!==(i=l.request("StyleList","returnModelById",o.get("styleId")))&&i.get("labelField")&&0<i.get("labelField").length?(n=i.get("labelField"),a=t.get(n),"["+s+"='"+t.get(s)+"' AND "+n+"='"+a+"']"):"["+s+"='"+t.get(s)+"']"},getStyleAttribute:function(e,t,r){var i,n,a=e.get("id"),o=l.request("ModelList","getModelByAttributes",{id:a}),s="styleId";return void 0!==o&&(o=this.getChildModelIfGroupLayer(o,a),i=l.request("StyleList","returnModelById",o.get("styleId")),o.get("styleId")&&(s=r&&void 0!==i?(n=i.getRulesForFeature(t)).length&&n[0]&&n[0].hasOwnProperty("conditions")?Object.keys(n[0].conditions.properties)[0]:"":i.get("styleField"))),s},getChildModelIfGroupLayer:function(e,t){var r=e;return"GROUP"===r.get("typ")&&(function(e){throw new TypeError('"'+e+'" is read-only')}("layerModel"),r=a.filter(r.get("layerSource"),function(e){return e.get("id")===t})[0]),r},rgbArrayToHex:function(e){var t,r,i,n="#3399CC";return Array.isArray(e)&&3<=e.length?(t=parseInt(e[0]),r=parseInt(e[1]),i=parseInt(e[2]),n="#"+this.componentToHex(t)+this.componentToHex(r)+this.componentToHex(i)):"string"==typeof e&&e.includes("#")&&4<=e.length&&(n=e),n},componentToHex:function(e){var t=e.toString(16);return 1==t.length?"0"+t:t},buildLegend:function(e,t,r){var i={},n=[];e&&0<t.length&&(i.layers=[],t.forEach(function(e){r&&n.push(e.layername),e.legend&&Array.isArray(e.legend)&&0<e.legend.length&&e.legend[0].hasOwnProperty("img")&&-1!==e.legend[0].img.indexOf(".pdf")?l.trigger("Alert","alert",{kategorie:"alert-info",text:'<b>Der Layer "'+e.layername+"\" enthält eine als PDF vordefinierte Legende. Diese kann nicht in den Ausdruck mit aufgenommen werden.</b><br>Sie können sich die vordefinierte Legende <a href='"+e.legend[0].img+"' target='_blank'><b>hier</b></a> separat herunterladen."}):i.layers.push({layerName:e.layername,values:this.prepareLegendAttributes(e)})},this)),this.setShowLegend(e),this.setLegend(i),r&&n.forEach(function(e){this.getMetaData(e)},this)},getMetaData:function(e){var t=l.request("ModelList","getModelByAttributes",{name:e}),r=t.get("datasets")&&t.get("datasets")[0]?t.get("datasets")[0].md_id:null,i=a.uniqueId(),n={};null!==r&&(this.get("uniqueIdList").push(i),n.layerName=e,n.metaId=r,n.keyList=["date","orgaOwner","address","email","tel","url"],n.uniqueId=i,l.trigger("CswParser","getMetaData",n))},prepareLegendAttributes:function(e){var t=[],r=e.legend&&Array.isArray(e.legend)&&0<e.legend.length?e.legend[0].typ:"";return"WMS"===r?t.push(this.createWmsLegendList(e.legend[0].img)):"WFS"===r?t.push(this.createWfsLegendList(e.legend[0].img,e.legend[0].legendname,e.layerName)):"styleWMS"===r&&t.push(this.createStyleWmsLegendList(e.legend[0].params)),a.flatten(t)},createWmsLegendList:function(e){var r=[],t=e;return"string"==typeof e&&(t=[t]),t.forEach(function(e){var t={legendType:"wmsGetLegendGraphic",geometryType:"",imageUrl:e,color:"",label:""};r.push(t)},this),r},createWfsLegendList:function(e,r,t){var i,n=[];return Array.isArray(e)?e.forEach(function(e,t){i=this.createWfsLegendObject(e,r[t]),n.push(i)},this):(i=this.createWfsLegendObject(e,t),n.push(i)),n},createWfsLegendObject:function(e,t){var r={legendType:"",geometryType:"",imageUrl:"",color:"",label:t};return-1!==e.indexOf("<svg")?(r.color=this.getFillFromSVG(e),r.legendType="geometry",r.geometryType="polygon"):(r.legendType="wfsImage",r.imageUrl=this.createLegendImageUrl(e)),r},createStyleWmsLegendList:function(e){var t=[];return e.forEach(function(e){t.push({legendType:"geometry",geometryType:"polygon",imageUrl:"",color:e.color,label:e.startRange+" - "+e.stopRange})}),t},getFillFromSVG:function(e){var t=e.indexOf("fill:")+5,r="#000000";return-1!==e.indexOf("fill:")&&(r=e.substring(t,t+7)),r},createLegendImageUrl:function(e){var t=e;return-1===t.indexOf("http")&&(t=this.buildGraphicPath(),t+=e.substring(e.lastIndexOf("/"))),t},buildGfi:function(e,t){var r,i,n={};e&&(0<t.length&&(n.layers=[],r=t[0],i=t[1],n.layers.push({layerName:i,values:this.prepareGfiAttributes(r)})),this.addGfiFeature(this.get("attributes").map.layers,t[2])),this.setShowGfi(e),this.setGfi(n)},addGfiFeature:function(e,t){var r=new g.a,i=new s.a({geometry:new n.a(t),name:"GFI Point"});e.splice(0,0,{type:"geojson",geojson:[r.writeFeatureObject(i)],style:{version:"2","[name='GFI Point']":{symbolizers:[{fillOpacity:0,pointRadius:18,strokeColor:"#e10019",strokeWidth:3,type:"point"},{fillColor:"#e10019",pointRadius:4,strokeOpacity:0,type:"point"}]}}})},prepareGfiAttributes:function(e){var t,r=[];for(t in e)r.push({key:t,value:e[t]});return r},buildScale:function(e){var t="1:"+e;this.setScale(t)},setMetadata:function(e){this.get("attributes").metadata=e},setShowLegend:function(e){this.get("attributes").showLegend=e},setLegend:function(e){this.get("attributes").legend=e},setShowGfi:function(e){this.get("attributes").showGfi=e},setGfi:function(e){this.get("attributes").gfi=e},setScale:function(e){this.get("attributes").scale=e},setUniqueIdList:function(e){this.set("uniqueIdList",e)},changeLang:function(e){this.set({currentLng:e,mapProjectionNotSupportedForLayer:t.t("additional:printLGB.mapProjectionNotSupportedForLayer")})}});f.default=h}.call(this,p(5),p(4),p(24),p(3))}}]);